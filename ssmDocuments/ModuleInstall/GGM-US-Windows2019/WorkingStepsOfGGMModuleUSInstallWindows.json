// Download Data, Installer, Scripts -------Success
{
  "schemaVersion": "2.2",
  "description": "RunCommandInstallGlobalGeocodingModule-Windows-OneScript",
  "parameters": {},
  "mainSteps": [
    {
      "action": "aws:downloadContent",
      "name": "downloadInstaller",
      "inputs": {
        "sourceType": "S3",
        "sourceInfo": {
          "path": "https://cloudformation-spectrum.s3.amazonaws.com/Modules/GGM/GGM-Windows/installers-22.1-nt/"
        },
        "destinationPath": "C:\\Program Files\\Precisely\\GGM\\installers-22.1-nt"
      }
    },
    {
      "action": "aws:downloadContent",
      "name": "downloadData",
      "inputs": {
        "sourceType": "S3",
        "sourceInfo": {
          "path": "https://cloudformation-spectrum.s3.amazonaws.com/Modules/GGM/data/"
        },
        "destinationPath": "C:\\Program Files\\Precisely\\GGM\\data"
      }
    },
    {
      "action": "aws:downloadContent",
      "name": "downloadScripts",
      "inputs": {
        "sourceType": "S3",
        "sourceInfo": {
          "path": "https://cloudformation-spectrum.s3.amazonaws.com/Modules/GGM/moduleScripts/"
        },
        "destinationPath": "C:\\Program Files\\Precisely\\GGM\\moduleScripts"
      }
    }
  ]
},
//Do I need a Waiting or Listener function here

// Install of Module---------------Success
{
  "schemaVersion": "2.2",
  "description": "RunCommandInstallGlobalGeocodingModule-Windows-OneScript",
  "parameters": {},
  "mainSteps": [
    {
      "action": "aws:runPowerShellScript",
      "name": "runInstaller",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["cd 'C:\\Program Files\\Precisely\\GGM\\installers-22.1-nt'", 
        "./install.exe"
        ]
      }
    }
  ]
}
//Listener for install completion?

//Move data to server/import--------Success
{
    "schemaVersion": "2.2",
    "description": "RunCommandInstallGlobalGeocodingModule-Windows-OneScript",
    "parameters": {},
    "mainSteps": [
      {
        "action": "aws:runPowerShellScript",
        "name": "runInstaller",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["Move-Item -Path 'C:\\Program Files\\Precisely\\GGM\\data\\*.spd' -Destination 'C:\\Program Files\\Precisely\\Spectrum\\server\\import'"]
        }
      }
    ]
  }
//Run script for configuration-----------Success
{
    "schemaVersion": "2.2",
    "description": "RunCommandInstallGlobalGeocodingModule-Windows-OneScript",
    "parameters": {},
    "mainSteps": [
      {
        "action": "aws:runPowerShellScript",
        "name": "createDBConnection",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["cd 'C:/Program Files/Precisely/spectrum-cli-22.1'",
                "./cli.cmd --cmdfile 'C:/Program Files/Precisely/GGM/moduleScripts/GgmResourceImport.cli'"]
        }
      }
    ]
  }
//Delete installer 

//Combined Script
{
    "schemaVersion": "2.2",
    "description": "RunCommandInstallGlobalGeocodingModule-US-Windows",
    "parameters": {},
    "mainSteps": [
      {
        "action": "aws:downloadContent",
        "name": "downloadInstaller",
        "inputs": {
          "sourceType": "S3",
          "sourceInfo": {
            "path": "https://cloudformation-spectrum.s3.amazonaws.com/Modules/GGM/GGM-Windows/installers-22.1-nt/"
          },
          "destinationPath": "C:\\Program Files\\Precisely\\GGM\\installers-22.1-nt"
        }
      },
      {
        "action": "aws:downloadContent",
        "name": "downloadData",
        "inputs": {
          "sourceType": "S3",
          "sourceInfo": {
            "path": "https://cloudformation-spectrum.s3.amazonaws.com/Modules/GGM/data/"
          },
          "destinationPath": "C:\\Program Files\\Precisely\\GGM\\data"
        }
      },
      {
        "action": "aws:downloadContent",
        "name": "downloadScripts",
        "inputs": {
          "sourceType": "S3",
          "sourceInfo": {
            "path": "https://cloudformation-spectrum.s3.amazonaws.com/Modules/GGM/GGM-Windows/moduleScriptsUSWindows2019/"
          },
          "destinationPath": "C:\\Program Files\\Precisely\\GGM\\moduleScriptsUSWindows2019"
        }
      },
      {
        "action": "aws:runPowerShellScript",
        "name": "runInstaller",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["cd 'C:\\Program Files\\Precisely\\GGM\\installers-22.1-nt'", 
          "./install.exe"
          ]
        }
      },
      {
        "action": "aws:runPowerShellScript",
        "name": "moveData",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["Move-Item -Path 'C:\\Program Files\\Precisely\\GGM\\data\\*.spd' -Destination 'C:\\Program Files\\Precisely\\Spectrum\\server\\import'"]
        }
      },
      {
        "action": "aws:runPowerShellScript",
        "name": "listenForDataUploadEGMWORLDAP202212",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["while (!(Test-Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\ref-data\\geocoding-all\\geocoding-all\\EGM-WORLD-AP-WLD_202212')) { Start-Sleep 10 }"]
        }
      },
      {
        "action": "aws:runPowerShellScript",
        "name": "listenForDataUploadEGMWORLDMLDGLB202212",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["while (!(Test-Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\ref-data\\geocoding-all\\geocoding-all\\EGM-WORLD-MLD-GLB_202212')) { Start-Sleep 10 }"]
        }
      },
      {
        "action": "aws:runPowerShellScript",
        "name": "listenForDataUploadEGMWORLDSTREETWBL202212",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["while (!(Test-Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\ref-data\\geocoding-all\\geocoding-all\\EGM-WORLD-STREET-WBL_202212')) { Start-Sleep 10 }"]
        }
      },
      {
        "action": "aws:runPowerShellScript",
        "name": "createDBConnection",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["cd 'C:/Program Files/Precisely/spectrum-cli-22.1'",
                "./cli.cmd --cmdfile 'C:/Program Files/Precisely/GGM/moduleScriptsUSWindows2019/GgmUSResourceImport.cli'"]
        }
      },
      
      {
        "action": "aws:runPowerShellScript",
        "name": "deleteEverything",
        "inputs": {
          "timeoutSeconds": 10800 ,
          "runCommand": ["Remove-Item 'C:\\Program Files\\Precisely\\GGM'"]
        }
      }
    ]
  }