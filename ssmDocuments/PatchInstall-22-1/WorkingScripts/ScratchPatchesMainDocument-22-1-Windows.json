{
  "schemaVersion": "2.2",
  "description": "RunCommandPatchesMainDocument-22-1-Windows",
  "parameters": {
    "GGMInstalled": {
      "default": "False",
      "type": "String",
      "allowedValues": [
        "True",
        "False"
      ]
    },
    "UAMInstalled": {
      "default": "False",
      "type": "String",
      "allowedValues": [
        "True",
        "False"
      ]
    },
    "GAVInstalled": {
      "default": "False",
      "type": "String",
      "allowedValues": [
        "True",
        "False"
      ]
    }
  },
  "mainSteps": [
    {
      "name": "DownloadGGMPatches",
      "action": "aws:runDocument",
      "precondition": {
        "StringEquals": [
          "{{GGMInstalled}}",
          "True"
        ]
      },
      "inputs": {
        "documentType": "SSMDocument",
        "documentPath": "InstallGGMPatches-22-1-Windows"
      }
    },
    {
      "name": "DownloadUAMPatches",
      "action": "aws:runDocument",
      "precondition": {
        "StringEquals": [
          "{{UAMInstalled}}",
          "True"
        ]
      },
      "inputs": {
        "documentType": "SSMDocument",
        "documentPath": "InstallUAMPatches-22-1-Windows"
      }
    },
    {
      "name": "DownloadGAVPatches",
      "action": "aws:runDocument",
      "precondition": {
        "StringEquals": [
          "{{GAVInstalled}}",
          "True"
        ]
      },
      "inputs": {
        "documentType": "SSMDocument",
        "documentPath": "InstallGAVPatches-22-1-Windows"
      }
    },
    {
      "name": "DownloadPlatformPatches",
      "action": "aws:runDocument",
      "inputs": {
        "documentType": "SSMDocument",
        "documentPath": "InstallPlatformPatches-22-1-Windows"
      }
    }

  ]
}





























Works as Automation Document - success, but many commands would need to be added

description: |-
  *Replace this default text with instructions or other information about your document.*  

  ---
  # What is Markdown?
  Markdown is a lightweight markup language that converts your content with plain text formatting to structurally valid rich text.
  ## You can add headings
  You can add *italics* or make the font **bold**.  
  1. Create numbered lists 
  * Add bullet points 
  >Indent `code samples` 

  You can create a [link to another webpage](${ AWS_ENDPOINT }).
schemaVersion: '0.3'
parameters:
  GGMInstalled:
    default: false
    type: Boolean
  UAMInstalled:
    default: false
    type: Boolean
  GAVInstalled:
    default: false
    type: Boolean
  InstallInstanceId:
    type: String
mainSteps:
- name: PatchInstall
  action: aws:branch
  inputs:
    Choices:
    - NextStep: InstallGGMPatches
      Variable: "{{GGMInstalled}}"
      BooleanEquals: true
    - NextStep: InstallUAMPatches
      Variable: "{{UAMInstalled}}"
      BooleanEquals: true
    - NextStep: InstallGAVPatches
      Variable: "{{GAVInstalled}}"
      BooleanEquals: true
    Default:
      InstallPlatformPatches
- name: InstallGGMPatches
  action: aws:runCommand
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstallInstanceId}}"
    Parameters:
      commands:
      - Copy-S3Object -BucketName arn:aws:s3:us-east-1:022735856553:accesspoint/spectrumproducts -Key Modules/GGM/GGM-Windows/moduleScriptsUSWindows/GgmUSDbResource.txt -LocalFile 'C:\Program Files\Precisely\GgmUSDbResource.txt'
  isEnd: false
- name: InstallUAMPatches
  action: aws:runCommand
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstallInstanceId}}"
    Parameters:
      commands:
      - Copy-S3Object -BucketName arn:aws:s3:us-east-1:022735856553:accesspoint/spectrumproducts -Key Modules/UAM/UAM-Windows/moduleScriptsUSWindows/UamUSDbResource.txt -LocalFile 'C:\Program Files\Precisely\UamUSDbResource.txt'
  isEnd: false
- name: InstallGAVPatches
  action: aws:runCommand
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstallInstanceId}}"
    Parameters:
      commands:
      - Copy-S3Object -BucketName arn:aws:s3:us-east-1:022735856553:accesspoint/spectrumproducts -Key Modules/GAV/GAV-Windows/moduleScriptsUSWindows/GAVUSDbResource.txt -LocalFile 'C:\Program Files\Precisely\GAVUSDbResource.txt'
  isEnd: false
- name: InstallPlatformPatches
  action: aws:runCommand
  inputs:
    DocumentName: "AWS-RunPowerShellScript"
    InstanceIds:
    - "{{InstallInstanceId}}"
    Parameters:
      commands:
      - Copy-S3Object -BucketName arn:aws:s3:us-east-1:022735856553:accesspoint/spectrumproducts -Key Modules/Platform/Patches22-1/Patches22-1.txt -LocalFile 'C:\Program Files\Precisely\Patches22-1.txt'
  isEnd: true




------------------------Referencing automatio docs for each patch install--------------Does not work, issue with instance ID getting passed
  description: |-
  *Replace this default text with instructions or other information about your document.*  

  ---
  # What is Markdown?
  Markdown is a lightweight markup language that converts your content with plain text formatting to structurally valid rich text.
  ## You can add headings
  You can add *italics* or make the font **bold**.  
  1. Create numbered lists 
  * Add bullet points 
  >Indent `code samples` 

  You can create a [link to another webpage](${ AWS_ENDPOINT }).
schemaVersion: '0.3'
parameters:
  GGMInstalled:
    type: Boolean
    description: Is Global Geocoding Module Installed?
  UAMInstalled:
    type: Boolean
    description: Is Universal Addressing Module Installed?
  GAVInstalled:
    type: Boolean
    description: Is Global Address Validation Module Installed?
  InstallInstanceId:
    type: 'AWS::EC2::Instance::Id'
    allowedPattern: '(^i-(\w{8}|\w{17})$)|(^op-\w{17}$)'
    description: Target Instance for Patch install
mainSteps:
  - name: PatchInstall
    action: 'aws:branch'
    inputs:
      Choices:
        - NextStep: InstallGGMPatches
          Variable: '{{GGMInstalled}}'
          BooleanEquals: true
        - NextStep: InstallUAMPatches
          Variable: '{{UAMInstalled}}'
          BooleanEquals: true
        - NextStep: InstallGAVPatches
          Variable: '{{GAVInstalled}}'
          BooleanEquals: true
      Default: InstallPlatformPatches
  - name: InstallGGMPatches
    action: 'aws:executeAutomation'
    inputs:
      DocumentName: InstallGGMPatches-22-1-Windows
      RuntimeParameters:
        - '{{InstallInstanceId}}'
    isEnd: true
  - name: InstallUAMPatches
    action: 'aws:executeAutomation'
    inputs:
      DocumentName: InstallUAMPatches-22-1-Windows
      RuntimeParameters:
        - '{{InstallInstanceId}}'
    isEnd: true
  - name: InstallGAVPatches
    action: 'aws:executeAutomation'
    inputs:
      DocumentName: InstallGAVPatches-22.1-AutomationDoc
      RuntimeParameters:
        - '{{InstallInstanceId}}'
    isEnd: true
  - name: InstallPlatformPatches
    action: 'aws:executeAutomation'
    inputs:
      DocumentName: InstallPlatformPatches-22-1-Windows
      RuntimeParameters:
        - '{{InstallInstanceId}}'
    isEnd: true
