{
  "schemaVersion": "2.2",
  "description": "RunCommandInstallPatchS07-22-1-Windows",
  "parameters": {},
  "mainSteps": [
    {
      "action": "aws:runPowerShellScript",
      "name": "lookForPatchS07",
      "inputs": {
        "timeoutSeconds": 300 ,
        "runCommand": ["while (!(Test-Path -Path 'C:\\Program Files\\Precisely\\Patches\\cdq20221s07')) {Start-Sleep 10}"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "stopServer",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Stop-Service -Name 'spectrum-server' -Force"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "listenForServerStop",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["while($true){ Get-Content 'C:\\Program Files\\Precisely\\Spectrum\\server\\logs\\spectrum-server.log' -Tail 1 -Wait | Select-String 'Precisely Spectrum Technology Platform shutdown complete' | %{write-host Found $_; break}}"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "createPatchS07Backup",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["New-Item -Path 'C:\\Program Files\\Precisely\\PatchesBackups' -Name 'PatchS07' -ItemType 'directory' "]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "backupServerModulesGGLib",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Copy-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\lib' -Destination 'C:\\Program Files\\Precisely\\PatchesBackups\\PatchS07\\server\\modules\\GlobalGeocode\\lib' -Recurse "]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "backupServerModulesGGSdk",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Copy-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk' -Destination 'C:\\Program Files\\Precisely\\PatchesBackups\\PatchS07\\server\\modules\\GlobalGeocode\\sdk' -Recurse "]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGLibAddress",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\lib\\addressing-api-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGLibCommons",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\lib\\commons-text-1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGLibGeocode",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\lib\\Geocode-5.1.*-client.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGLibGeocodingApi",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\lib\\geocoding-api-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGLibGeocodingJson",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\lib\\geocoding-jsonconfig-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkAddressA",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\addressing-api-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkAddressFinal",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\addressing-finalist-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkAddressGGS",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\addressing-ggs-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkAddressGlobal",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\addressing-global-locator-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkAddressParse",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\addressing-parser-ggs-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkAddressSdk",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\addressing-sdk-runtime-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkCommons",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\commons-text-1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkCountry",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\country-finder-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkGeoApi",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\geocoding-api-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkGeoApiGeo",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\geocoding-api-geostan-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteServerModulesGGSdkGeoJson",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item -Path 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode\\sdk\\geocoding-jsonconfig-5.1.*.jar' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "deleteG1Assemblies",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Remove-Item 'C:\\Users\\Administrator\\AppData\\Local\\Temp\\g1Assemblies' -Recurse -Force -Confirm:$false"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "replaceServerModulesGGLib",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Copy-Item -Path 'C:\\Program Files\\Precisely\\Patches\\cdq20221s07\\server\\modules\\GlobalGeocode\\lib' -Destination 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode' -Recurse -Force"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "replaceServerModulesGGSdk",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Copy-Item -Path 'C:\\Program Files\\Precisely\\Patches\\cdq20221s07\\server\\modules\\GlobalGeocode\\sdk' -Destination 'C:\\Program Files\\Precisely\\Spectrum\\server\\modules\\GlobalGeocode' -Recurse -Force"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "startServer",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["Start-Service -Name 'spectrum-server'"]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "listenForServerStart",
      "inputs": {
        "timeoutSeconds": 10800 ,
        "runCommand": ["while($true){ Get-Content 'C:\\Program Files\\Precisely\\Spectrum\\server\\logs\\spectrum-server.log' -Tail 1 -Wait | Select-String -Pattern 'Precisely Spectrum Technology Platform' | %{write-host Found $_; break}}"]
      }
    }
  ]
}